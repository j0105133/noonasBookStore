<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <link rel="stylesheet" href="CSS/detail.css" />
    <link rel="stylesheet" href="CSS/main.css" />
    <link rel="stylesheet" href="CSS/product.css" />
    <link rel="stylesheet" href="CSS/reset.css" />
    <link rel="stylesheet" href="CSS/search.css" />
    <link rel="stylesheet" href="CSS/slick.css" />
    <link rel="stylesheet" href="CSS/style.css" />
    <title>책 상세 정보</title>
    <style>       
        .detail__container {
            display: flex;
            justify-content: center;
            padding: 20px;
        }
        .book__detail {
            background-color: #fff;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 20px;
            max-width: 800px;
            width: 100%;
            box-sizing: border-box;
            overflow: hidden;
            display: flex; 
        }
        .book__detail img {
            max-width: 300px; 
            height: auto;
            display: block;
            margin-right: 20px; 
        }
        .book__detail__info {
            flex: 1; 
        }
        .book__detail h2 {
            font-size: 24px;
            margin-bottom: 10px;
        }
        .book__detail p {
            margin: 5px 0;
            font-size: 16px;
            word-break: break-all;
        }
        .book__detail p strong {
            font-weight: bold;
        }
        .book__detail div {
            border-top: 1px solid #ddd;
            padding-top: 10px;
        }
        .detail-button {
            margin-top: 20px;
            padding: 10px 20px;
            background-color: #007BFF;
            color: #fff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            text-align: center;
            display: inline-block;
            text-decoration: none; 
        }
        .detail-button:hover {
            background-color: #0056b3;
        }
    </style>
</head>
<body>
    <!--header : common/hearder.html-->
    <header class="header" id="header"> 
        <div class="header__event"></div>        
        <div class="header__container wrap">            
            <h1><a href="/">Noona<span>Book</span>Store</a></h1>
            <!--search-->
            <div class="search-form">
                <input type="text" id="customTextInput" placeholder="검색어를 입력하세요">
                <button id="customSearchBtn">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="white" viewBox="0 0 16 16">
                        <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001a1.007 1.007 0 0 0-.196.196l-3.85 3.85a1 1 0 0 0 1.415 1.415l3.85-3.85a1 1 0 0 0 .196-.196v-.001a6.5 6.5 0 0 0 1.398-1.397zm-5.982.066a5.5 5.5 0 1 1 7.78-7.78 5.5 5.5 0 0 1-7.78 7.78z"/>
                    </svg>
                </button>
            </div> 
            <!--//search-->                   
        </div>      
    </header> 
    <!--header : common/header.html-->
    <header class="header" id="header"></header>
    <!--//header-->
    <!--nav : common/nav.html-->
    <nav id="nav"></nav>
    <!--//nav-->
    <!--container-->
    <section class="detail__container wrap">
        <article class="book__detail mgT40">
            <img id="bookThumbnail" src="" alt="Book Thumbnail">
            <div class="book__detail__info">
                <h2 id="bookTitle"></h2>
                <div id="bookInfo"></div>
                <a id="detailButton" class="detail-button" href="#">상세보기</a>
            </div>
            <script>
                $(document).ready(function() {
                    // URL에서 isbn 파라미터 추출
                    const urlParams = new URLSearchParams(window.location.search);
                    const isbn = decodeURIComponent(urlParams.get('isbn')); // 디코딩된 ISBN 값 사용

                    if (isbn) {
                        fetchBookDetail(isbn);
                    }

                    function fetchBookDetail(isbn) {
                        $.ajax({
                            method: "GET",
                            url: `https://dapi.kakao.com/v3/search/book?target=isbn&query=${isbn}`,
                            headers: { Authorization: `KakaoAK f4aacc94a442dd1e084f37ce4cad76cb` }
                        })
                        .done(function(data) {
                            if (data.documents && data.documents.length > 0) {
                                const book = data.documents[0];
                                displayBookDetail(book);
                            } else {
                                $('#bookInfo').html('<p>책 정보를 찾을 수 없습니다.</p>');
                            }
                        });
                    }

                    function displayBookDetail(book) {
                        $('#bookThumbnail').attr('src', book.thumbnail);
                        $('#bookTitle').text(book.title);
                        const bookHTML = `
                            <p><strong>저자:</strong> ${book.authors.join(', ')}</p>
                            <p><strong>출판사:</strong> ${book.publisher}</p>
                            <p><strong>가격:</strong> ${book.price}원</p>
                            <p><strong>설명:</strong> ${book.contents}</p>
                        `;
                        $('#bookInfo').html(bookHTML);
                        $('#detailButton').attr('href', book.url); // 상세보기 링크 설정
                    }
                });
            </script>
        </article>
    </section>
    <!—//container—>
    <footer id="footer"></footer>
</body>
    <script src="/JS/search.js"></script>
    <script src="/JS/common.js"></script>
    <script src="/JS/detail.js"></script>
    <script src="/JS/main.js"></script>
    <script src="/JS/product.js"></script>

    <script>
        $(document).ready(function() {
            // URL에서 isbn 파라미터 추출
            const urlParams = new URLSearchParams(window.location.search);
            const isbn = decodeURIComponent(urlParams.get('isbn')); // 디코딩된 ISBN 값 사용

            if (isbn) {
                fetchBookDetail(isbn);
            }

            function fetchBookDetail(isbn) {
                $.ajax({
                    method: "GET",
                    url: `https://dapi.kakao.com/v3/search/book?target=isbn&query=${isbn}`,
                    headers: { Authorization: `KakaoAK f4aacc94a442dd1e084f37ce4cad76cb` }
                })
                .done(function(data) {
                    if (data.documents && data.documents.length > 0) {
                        const book = data.documents[0];
                        displayBookDetail(book);
                        console.log("sdsdsd", data);
                    } else {
                        $('#detail-board').html('<p>책 정보를 찾을 수 없습니다.</p>');
                    }
                });
            }

            function displayBookDetail(book) {
                console.log(book.url, "bookurl")
                $('#detail-img').attr('src', book.thumbnail || 'default-thumbnail.jpg');
                $('#detail-info-cate').text(book.category || "카테고리 정보 없음");
                $('#detail-info-title').text(book.title);
                $('#detail-info-author').text(book.authors.join(', '));
                $('#detail-info-page').text(book.page || "페이지 정보 없음");
                $('#detail-info-otitle').text(book.translators.join(', ') || "원제 정보 없음");
                $('#detail-info-pub').text(book.publisher);
                $('#detail-info-isbn').text(book.isbn);
                $('#detail-book-desc').text(book.contents);

                // 구매 버튼 링크 설정
                $('#detail-book-buy-btn-kakao').attr('href', book.url);
                
                $('#detail-book-buy-btn-aladin').attr('href', `https://www.aladin.co.kr/shop/wproduct.aspx?ISBN=${isbn}`);
                $('#detail-book-buy-btn-kyobo').attr('href', `https://www.kyobobook.co.kr/product/detailViewKor.laf?barcode=${isbn}`);
                $('#detail-book-buy-btn-yes24').attr('href', `http://www.yes24.com/Product/Goods/${isbn}`);
            }
        });
    </script>
  </body>
</body>
</html>
<footer id="footer"></footer>
<script src="/JS/search.js"></script>
<script src="/JS/common.js"></script>
<script src="/JS/main.js"></script>
<script src="/JS/product.js"></script>
</body>
</html>